<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Release Monitoring with Automation for Jira</title>
<meta name="generator" content="Org Mode" />
<link rel="stylesheet" type="text/css" href="/stylesorg.css"/>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Fira+Mono&display=swap">
<link rel="icon" type="image/x-icon" href="/favicon.ico">
</head>
<body>
<div id="preamble" class="status">
<hr style="border-top: 1px solid black;">
<div class='topnav' style='display: flex; justify-content: space-between; align-items: center;'>
  <a href="/index.html"><h2 style='margin-top: 0; margin-bottom: 0; margin-left:0px;'>mblognl</h2></a>
  <div>
    <a href='/about.html' style='font-weight:bold; font-style:italic;'>About Me</a> |
    <a href='/archive.html' style='font-weight:bold; font-style:italic;'>Blog</a> |
    <a href='/books.html' style='font-weight:bold; font-style:italic;'>Books</a> |
    <a href='/rss.xml' style='font-weight:bold; font-style:italic;'>RSS</a>
  </div>
</div>
<hr style="border-top: 1px solid black;">
</div>
<div id="content" class="content">
<header>
<h1 class="title">Release Monitoring with Automation for Jira</h1>
</header>
<div id="outline-container-orgc7534ca" class="outline-2">
<h2 id="orgc7534ca">We like automation, we like monitoring releases <i class="fa-regular fa-heart"></i></h2>
<div class="outline-text-2" id="text-orgc7534ca">
<div class="PREVIEW" id="org7890b13">
<p>
So your organisation has decided to build a Internal Developer Portal (IDP) using Backstage. All of a sudden you're responsible for looking after a quickly growing, forever updating production environment, as well as an IDP?
</p>

</div>

<p>
You may even have a request from your SEM along the lines of this:
</p>

<blockquote>
<p>
Monthly there is a version bump of Backstage (i.e 1.14.x -&gt; 1.15.0)
We need to keep up with these releases as this reduces issues with security etc - however with this release we also need to update the plugin dependencies.
</p>
</blockquote>

<p>
What do you do about:
</p>

<ul class="org-ul">
<li>Monitoring new releases</li>
<li>Making decisions about new features</li>
<li>Breaking changes</li>
<li>Plugins breaking</li>
</ul>

<p>
You monitor the releases in a Jira project backlog of course!
</p>
</div>
</div>

<div id="outline-container-org24e53a6" class="outline-2">
<h2 id="org24e53a6">Here is how I did it with automation&#x2026; <i class="fa-solid fa-robot"></i></h2>
<div class="outline-text-2" id="text-org24e53a6">
<p>
I wanted to create a new task whenever a new release of Backstage is rolled out on the main Github page <i class="fa-brands fa-github-alt"></i> <a href="https://github.com/backstage/backstage">backstage/backstage</a>. The task could then be broken down into smaller pieces of work or spikes so I could monitor builds or raise pull requests directly from Jira using the GitHub integration.
</p>
</div>
</div>

<div id="outline-container-orgb69cedf" class="outline-2">
<h2 id="orgb69cedf">Setting up the Schedule <i class="fa-regular fa-calendar"></i></h2>
<div class="outline-text-2" id="text-orgb69cedf">
<p>
For the scheduled automation to work I created a custom field in Jira called 'Release Tag', which is where the release tag will be stored.
</p>

<p>
The specifics of the JQL might need adjusting depending on your circumstances but an example may go like:
</p>

<p>
<code>issuetype = epic and 'Release Tag' is not EMPTY</code>
</p>

<p>
Because the scheduled automation requires a ticket to be present I had to make a 'dummy' ticket with the release tag of a previous release added to it, so when the schedule runs the JQL can find a ticket and trigger the subsequent automation. There is a space at the bottom of the following example when you're creating a scheduled automation to add JQL.
</p>


<figure id="orgc5b7a39">
<img src="../afj-release.png" alt="afj-release.png" style="margin:auto; display:block; width:400px">

<figcaption><span class="figure-number">Figure 1: </span>Schedule the Automation</figcaption>
</figure>
</div>
</div>

<div id="outline-container-org1dbefeb" class="outline-2">
<h2 id="org1dbefeb">The Web Request <i class="fa-solid fa-globe"></i></h2>
<div class="outline-text-2" id="text-org1dbefeb">
<p>
The automation will make a request to a public endpoint, so there was need for a Personal Access Token (PAT). Since the request frequency is once a day, it remains within rate limits. The request is made to the following URL:
</p>

<p>
<a href="https://api.github.com/repos/backstage/backstage/releases/latest">API for Latest Release</a>
</p>

<p>
Then I added optional headers to ensure the content type is correctly interpreted:
</p>

<p>
<code>Content-Type: application/json</code>
</p>

<p>
This is a GET HTTP method, and I didn't anticipate any issue references in the body, simply can choose 'Empty'.
</p>

<p>
<b>It's crucial to delay execution until we receive a response from this web request!</b>
</p>


<figure id="org1530611">
<img src="../afj-release-3.png" alt="afj-release-3.png" style="margin:auto; display:block; width:400px">

<figcaption><span class="figure-number">Figure 2: </span>Web Request Example</figcaption>
</figure>
</div>
</div>

<div id="outline-container-org473ccf6" class="outline-2">
<h2 id="org473ccf6">Create Variable <i class="fa-solid fa-check"></i></h2>
<div class="outline-text-2" id="text-org473ccf6">
<p>
The web response body will look a bit like the snipped example:
</p>

<div class="org-src-container">
<pre class="src src-js">}
  <span class="org-comment-delimiter">// </span><span class="org-comment">...</span>
  <span class="org-string">"node_id"</span>: <span class="org-string">"RE_kwDODhKIWM4Gb0sX"</span>,
  <span class="org-string">"tag_name"</span>: <span class="org-string">"v1.14.2"</span>,
  <span class="org-string">"target_commitish"</span>: <span class="org-string">"master"</span>,
  <span class="org-string">"name"</span>: <span class="org-string">"v1.14.2"</span>,
  <span class="org-string">"draft"</span>: <span class="org-constant">false</span>,
  <span class="org-string">"prerelease"</span>: <span class="org-constant">false</span>,
  <span class="org-string">"created_at"</span>: <span class="org-string">"2023-06-09T09:30:18Z"</span>,
  <span class="org-string">"published_at"</span>: <span class="org-string">"2023-06-09T09:30:19Z"</span>,
  <span class="org-string">"assets"</span>: [

  ],
  <span class="org-string">"tarball_url"</span>: <span class="org-string">"https://api.github.com/repos/backstage/backstage/tarball/v1.14.2"</span>,
  <span class="org-string">"zipball_url"</span>: <span class="org-string">"https://api.github.com/repos/backstage/backstage/zipball/v1.14.2"</span>,
  <span class="org-string">"body"</span>: <span class="org-string">"This release fixes an issue where the search bar styling would break."</span>,
 <span class="org-comment-delimiter">// </span><span class="org-comment">...</span>
}
</pre>
</div>

<p>
To extract the <code>tag_name</code>, I created a variable using the newer feature, referring to the <code>{{webResponse.body}}</code> (the curly brackets are to use Jira smart values) to retrieve the response body, and then pointing to the <code>tag_name</code>. This creates a variable named <code>backstageLatest</code> that can be referenced in subsequent actions.
</p>


<figure id="org46a7d47">
<img src="../afj-release-1.png" alt="afj-release-1.png" style="margin:auto; display:block; width:400px">

<figcaption><span class="figure-number">Figure 3: </span>Release Tag Variable</figcaption>
</figure>
</div>
</div>

<div id="outline-container-org6f9db75" class="outline-2">
<h2 id="org6f9db75">Create a new ticket <i class="fa-solid fa-ticket"></i></h2>
<div class="outline-text-2" id="text-org6f9db75">
<p>
I then used the 'If: Matches' conditional module to verify if <code>backstageLatest</code> is greater than the release number in the custom release field. If it is, then I want to create a new ticket in the backlog with:
</p>

<ul class="org-ul">
<li>Summary: Backstage <code>{{backstageLatest}}</code> New Release</li>

<li>Description: <code>{{webResponse.body.body}}</code></li>

<li>Label: On-going Backstage Maintenance</li>
</ul>

<p>
If the conditions don't match, the automation doesn't perform any actions.
</p>


<figure id="orga7854e0">
<img src="../afj-release-2.png" alt="afj-release-2.png" style="margin:auto; display:block; width:400px">

<figcaption><span class="figure-number">Figure 4: </span>Backstage Latest Variable</figcaption>
</figure>
</div>
</div>

<div id="outline-container-org9edec4a" class="outline-2">
<h2 id="org9edec4a">Conclusion <i class="fa-solid fa-flag-checkered"></i></h2>
<div class="outline-text-2" id="text-org9edec4a">
<p>
By following the above steps, you can set up a process to automatically monitor GitHub releases and track your dependencies. This will save you time and effort to manually check for new releases.
</p>

<p>
Future suggestions/ideas:
</p>

<ul class="org-ul">
<li>Trigger builds in your CI/CD if conditionals pass, or a status matches 'release'</li>

<li>Enrich tickets but using Key Values from the json response to further automate the process</li>

<li><p>
Use this idea for other dependencies
</p>

<p>
If you have any other ideas or questions please reach out. <i class="fa-regular fa-heart"></i>
</p></li>
</ul>
</div>
</div>
</div>
<div id="postamble" class="status">
<div class="postamble" style="text-align: center; margin-top: 20px; margin-bottom: 20px;"> 
               <p> Created by <a href="https://www.gnu.org/software/emacs/">Emacs</a> 29.3 (<a href="https://orgmode.org">Org</a> mode 9.6.15)  </p>
               </div>
</div>
</body>
</html>
